# Load necessary libraries
library(readxl)  # For reading Excel files
library(dplyr)   # For data manipulation

# Function to process a single table and column
process_column <- function(table_name, column_name) {
  # Read the table (assuming each table is stored in a different sheet)
  data <- read_excel("your_excel_file.xlsx", sheet = table_name)
  
  # Check if the column exists in the table
  if (!column_name %in% colnames(data)) {
    stop(paste("Column", column_name, "not found in table", table_name))
  }
  
  # Extract the column data
  column_data <- data[[column_name]]
  
  # Remove missing values
  column_data <- column_data[!is.na(column_data)]
  
  # Get distinct values
  distinct_values <- unique(column_data)
  
  # Sample 5 random values
  sample_values <- sample(column_data, size = min(5, length(column_data)), replace = FALSE)
  
  # Return a list containing distinct values and the sample values
  return(list(
    distinct_values = distinct_values,
    sample_values = sample_values
  ))
}

# Main function to process all tables and columns
process_excel <- function(excel_file, table_column_sheet) {
  # Read the sheet containing the table and column names
  table_column_info <- read_excel(excel_file, sheet = table_column_sheet)
  
  # Create an empty list to store results
  results_list <- list()
  
  # Loop through each row in the sheet to process the table and column
  for (i in 1:nrow(table_column_info)) {
    table_name <- table_column_info$Table[i]
    column_name <- table_column_info$Column[i]
    
    # Process the column and get the result
    result <- process_column(table_name, column_name)
    
    # Store the result in the list
    results_list[[paste(table_name, column_name, sep = "_")]] <- result
  }
  
  # Return the final list of results
  return(results_list)
}

# Example usage:
# Assuming 'table_column_sheet' contains two columns: 'Table' and 'Column',
# and the Excel file is named "your_excel_file.xlsx".
results <- process_excel("your_excel_file.xlsx", "table_column_sheet")

# View the results
print(results)
